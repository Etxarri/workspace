<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
    <title layout:title="Resultado de la encuesta"></title>
</head>
<body layout:fragment="content">
        <div class="col-12 text-center">
            <h3>
                <i class="bi bi-collection"></i>
                <span th:text="${tituloPagina}">Resultados de la Encuesta</span>
            </h3>
        </div>
    <div>
        <!-- Resultado total -->
        <div class="text-center p-2 my-2">
            <div class="card shadow-sm mx-auto" style="max-width: 50%;">
                <div class="card-body">
                    <h5 class="card-title mb-3">Índice total de integración</h5>
                    <div class="d-inline-block">
                        <div class="rounded-circle p-4" th:style="${'background-color: ' + 
                            (encuesta.resultadoTotal >= 0.9 ? 'rgba(25, 135, 84, 0.1)' :
                            encuesta.resultadoTotal >= 0.7 ? 'rgba(13, 202, 240, 0.1)' :
                            encuesta.resultadoTotal >= 0.5 ? 'rgba(255, 193, 7, 0.1)' :
                            encuesta.resultadoTotal >= 0.3 ? 'rgba(220, 53, 69, 0.1)' : 
                            'rgba(33, 37, 41, 0.1)') + ';' +
                            'border: 3px solid ' +
                            (encuesta.resultadoTotal >= 0.9 ? '#198754' :
                            encuesta.resultadoTotal >= 0.7 ? '#0dcaf0' :
                            encuesta.resultadoTotal >= 0.5 ? '#ffc107' :
                            encuesta.resultadoTotal >= 0.3 ? '#dc3545' : 
                            '#212529') + ';'}">
                            <div class="d-flex flex-column align-items-center">
                                <span class="display-4 fw-bold mb-0" 
                                    th:style="${'color: ' + 
                                        (encuesta.resultadoTotal >= 0.9 ? '#198754' :
                                        encuesta.resultadoTotal >= 0.7 ? '#0dcaf0' :
                                        encuesta.resultadoTotal >= 0.5 ? '#ffc107' :
                                        encuesta.resultadoTotal >= 0.3 ? '#dc3545' : 
                                        '#212529')}"
                                    th:text="${#numbers.formatDecimal(encuesta.resultadoTotal, 1, 4)}">
                                </span>
                                <small class="text-muted mt-2" 
                                    th:text="${encuesta.resultadoTotal >= 0.9 ? 'Excelente' :
                                                encuesta.resultadoTotal >= 0.7 ? 'Alto' :
                                                encuesta.resultadoTotal >= 0.5 ? 'Moderado' :
                                                encuesta.resultadoTotal >= 0.3 ? 'Bajo' : 
                                                'Ínfimo'}">
                                </small>
                            </div>
                        </div>
                    </div>
                    <p class="text-muted mt-3 mb-0 small">
                        <i class="bi bi-info-circle me-1"></i>
                        Este índice representa tu nivel general de integración
                    </p>
                </div>
            </div>
        </div>

        <div class="encuesta-results">
            <div class="row">
                <!-- Columna para el gráfico -->
                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title text-center mb-2">Gráfico de integración por áreas</h5>
                            <canvas id="graficoPolar"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Columna para consejos -->
                <div class="col-md-6 pe-2">
                    <!-- Nivel de integración general -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title grafico-titulo" th:text="'Nivel de integración general'" th:attr="data-text='Nivel de integración general'">Nivel de integración general</h5>
                            <div th:if="${nivelGeneral}" class="mb-3">
                                <h6 class="mb-2">
                                    Nivel: 
                                    <span class="badge grafico-nivel" th:class="${'badge ' + 
                                        (nivelGeneral.nivel == 'Excelente' ? 'bg-success' :
                                        nivelGeneral.nivel == 'Alto' ? 'bg-info' :
                                        nivelGeneral.nivel == 'Moderado' ? 'bg-warning' :
                                        nivelGeneral.nivel == 'Bajo' ? 'bg-danger' : 'bg-dark')}"
                                        th:text="${nivelGeneral.nivel}" th:attr="data-text=${nivelGeneral.nivel}">
                                    </span>
                                </h6>
                                <p class="card-text grafico-descripcion" th:text="${nivelGeneral.descripcion}" th:attr="data-text=${nivelGeneral.descripcion}"></p>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item grafico-consejo" th:each="consejo : ${nivelGeneral.consejos}" th:text="${consejo}" th:attr="data-text=${consejo}"></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Área que necesita más atención -->
                    <div class="card shadow-sm" th:if="${areaDebil}">
                        <div class="card-body">
                            <h5 class="card-title">Área que necesita más atención</h5>
                            <h6 class="mb-3" th:text="${'Área: ' + #strings.capitalize(areaDebil)}"></h6>
                            <div class="alert alert-info">
                                <h6 class="mb-2">Consejos específicos:</h6>
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-2" th:each="consejo : ${consejosAreaDebil}">
                                        <i class="bi bi-arrow-right-circle me-2"></i>
                                        <span th:text="${consejo}"></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botón para volver-->
        <div class="text-center mt-3 mb-5" style="min-width: 150px;">
            <a href="/encuestas" class="btn btn-secondary"> ← Volver a encuestas</a>
        </div>

        <script th:inline="javascript">
            // Obtener datos de Thymeleaf
            const encuesta = /*[[${encuesta}]]*/ null;

            const etiquetas = ["Psicológica", "Lingüística",
                                "Económica", "Política",
                                "Social", "Navegacional"];

            const datosGrafico = [encuesta.resultadoPsicologico,
                                encuesta.resultadoLinguistico,
                                encuesta.resultadoEconomico,
                                encuesta.resultadoPolitico,
                                encuesta.resultadoSocial,
                                encuesta.resultadoNavegacional];
        </script>
        <script src="/js/graficoAreasEncuestas.js"></script>
    </div>
    <!-- <div th:replace="fragments/aside :: aside"></div>
    <footer th:replace="fragments/footer :: footer"></footer>     -->
</body>
</html>