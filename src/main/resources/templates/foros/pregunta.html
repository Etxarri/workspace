<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
  <head>
    <title layout:title="Pregunta"></title>
  </head>
<body>
<main layout:fragment="content">
    <main class="container py-5">
      <a class="btn btn-link text-decoration-none" th:href="@{/foro/{temaID}(temaID=${temaID})}" style="font-size: 1.2rem;">
          <i class="bi bi-arrow-left-circle-fill"></i> <span th:text="#{volver}">Volver</span>
      </a>
        
      <div class="mb-4">
        <div class="list-group-item mb-3">
          <h2 class="mb-2">
            <i class="bi bi-question-circle"></i>
            <span class="pregunta-original" th:text="${pregunta.pregunta}">Título de la pregunta</span>
          </h2>
        </div>
        <div class="text-muted mb-2">
          <i class="bi bi-calendar"></i>
          <span th:text="${#dates.format(pregunta.fechaCreacion, 'dd/MM/yyyy')}">Fecha</span>
        </div>
        <div>
          <!-- <span class="badge bg-primary">Hilo #<span th:text="${hilo.hiloID}">1</span></span> -->
        </div>
      </div>

      <section class="mb-5">
        <h4 class="mb-3"><i class="bi bi-chat-dots" th:text="#{pregunta.comentario}"></i> </h4>
        <div th:if="${comentarios == null or #lists.isEmpty(comentarios)}" class="alert alert-info" th:text="#{nohaycomentarios}"></div>
        <div class="list-group mb-4" th:if="${comentarios != null and !#lists.isEmpty(comentarios)}">
          <div class="mb-2"
              th:each="comentario : ${comentarios}"
              th:classappend="${comentario.usuario.usuarioID == usuarioLogueado.usuarioID} ? 'd-flex justify-content-end' : 'd-flex justify-content-start'">
            <div class="list-group-item"
                th:classappend="${comentario.usuario.usuarioID == usuarioLogueado.usuarioID} ? 'bg-info text-dark text-white align-self-end' : 'bg-light align-self-start'"
                style="max-width: 60%; border-radius: 1rem;">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <i class="bi bi-person-circle text-primary"></i>
                  <strong th:text="${comentario.usuario.nombre}">Usuario</strong>
                </div>
                <small class="text-muted" th:text="${#temporals.format(comentario.fechaHora, 'dd/MM/yyyy HH:mm')}">Fecha</small>
              </div>
              <div class="mt-2" th:text="${comentario.contenido}">Contenido del comentario</div>
              <div>
                <form th:action="@{/foro/{hiloID}/{preguntaID}/{comentarioID}(hiloID=${hilo.hiloID}, preguntaID=${pregunta.preguntaID}, comentarioID=${comentario.comentarioID})}" method="post">
                  <input type="hidden" name="comentarioID" th:value="${comentario.comentarioID}"/>
                  <button type="submit"
                          th:class="'btn ' + (${comentario.usuariosQueDieronLike.contains(usuarioLogueado)} ? 'btn-success' : 'btn-outline-secondary')">
                    <i class="bi bi-hand-thumbs-up-fill"></i>
                  </button>                  
                  <span class="ms-2" th:text="${comentario.usuariosQueDieronLike.size()}">0</span>
                </form>

              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Formulario para añadir un nuevo comentario -->
      <section>
        <h5 class="mb-3" th:text="#{pregunta.añadir.comentario}"><i class="bi bi-pencil-square"></i> Añadir comentario</h5>
        <form th:action="@{/foro/{hiloID}/{preguntaID}/comentario(hiloID=${hilo.hiloID}, preguntaID=${pregunta.preguntaID})}" method="post">
          <div class="mb-3">
            <textarea class="form-control" name="contenido" rows="3" placeholder="Escribe tu comentario..." required></textarea>
          </div>
          <button type="submit" class="btn btn-success" th:text="#{pregunta.publicar}"><i class="bi bi-send"></i> Publicar</button>
        </form>
      </section>
    </main>
  </body>
</html>